<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="styles.css">
  </head>

  <body>
    <div class="controls" id="controls">
      <button class="picker" onclick="pickPotentialChunk()">Pick a random potential chunk!</button>
    </div>
    <div class="completeDiv" id="superParent">
      <div class="imgDiv" id="imgDiv">
          <img class="overlay" id="overlay" src="grid overlay.png">
          <img class="map" id="map" src="osrs_world_map_jan4_2019.png">
          <div class="btnDiv" id="btnDiv"></div>
      </div>
    </div>
    <div class="disclaimer">
      <p>The Old School RuneScape world map is copyright Â© Jagex Games Ltd.</p>
      <p>This website is not affiliated with Jagex Games Ltd.</p>
    </div>
  </body>

  <script>
    window.onload = buildArray(25, 43);

    var dragging = false;
    $("#imgDiv").draggable({
      drag: function() { dragging = true; }
    });

    function buildArray(rows, columns) {
      for (var i = 0; i < rows; i++) {
        for (var j = 0; j < columns; j++) {
          var btn = document.createElement("div");
          btn.className = "invisible";
          btn.id = "button" + (i * columns + j).toString();
          btn.setAttribute("onclick", "toggleChunkButton(this.id)");
          document.getElementById("btnDiv").appendChild(btn);
        }
      }
    }

    var counter = 0;
    function toggleChunkButton(id) {
      if (dragging == true) {
        dragging = false;
      }
      else {
        var btn = document.getElementById(id);
        if (btn.className == "invisible") {
          counter += 1;
          btn.innerText = counter;
          btn.className = "potential";
        }
        else if (btn.className == "potential") {
          counter -= 1;
          btn.innerText = "";
          btn.className = "visible";
        }
        else if (btn.className == "visible") {
          btn.className = "invisible";
        }
      }
    }

    function pickPotentialChunk() {
      const chunks = document.getElementsByClassName("potential");
      if (chunks.length == 0) return;

      var randomIndex = Math.floor(Math.random() * chunks.length);
      for (var i = chunks.length - 1; i >= 0; i--) {
        if (i == randomIndex) {
          var chunk = chunks[i];
          chunk.className = "between";
          setTimeout(function() {
            chunk.className = "visible";
          }, 1000);
        }
        else {
          chunks[i].className = "invisible";
        }
      }

      counter = 0;
    }
  </script>
</html>
